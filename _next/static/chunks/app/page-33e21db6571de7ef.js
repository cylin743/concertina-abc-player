(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5428:function(e,s,t){Promise.resolve().then(t.bind(t,6911))},6911:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var l=t(7437),n=t(2265);t(9302);var a=t(7907),i=t(3224),r=t.n(i),o=t(6344),h=t(6926),c=t(6285),u=t(7241),d=t(6929),p=t(2486),f=t(1787);function g(){let e=t(1514),s=(0,a.useSearchParams)();var i=s.get("t")||"";i=""==i?atob(i=s.get("tune")||""):r().decompressFromBase64(decodeURIComponent(i))||"";let[g,y]=(0,n.useState)("C"),[v,x]=(0,n.useState)(i),[C,b]=(0,n.useState)(!1),[S,j]=(0,n.useState)(null),[k,w]=(0,n.useState)(""),[E,T]=(0,n.useState)(!1);(0,n.useRef)(null);let[W,P]=(0,n.useState)(0),[_,O]=(0,n.useState)({def:"push",scales:[]}),[Z,B]=(0,n.useState)(""),F=e=>{window.open(e,"_blank","noreferrer")},R=r().compressToBase64(v),I=class{colorElements(e){for(var s=0,t=0,l=!1,n=!1,a="push",i="pull",r={},o=0;o<this.lastEls.length;o++)for(var c=0;c<this.lastEls[o].length;c++)this.lastEls[o][c].style.color="";for(var u=[],o=0;o<e.length;o++)for(var c=0;c<e[o].length;c++){e[o][c].style.color="brown";for(var d=0;d<e[o][c].children.length;d++){if("chord"==e[o][c].children[d].dataset.name||"lyric"==e[o][c].children[d].dataset.name){let s=e[o][c].children[d].textContent.toLowerCase();"push"==s||"r"==s||"]["==s?n=!0:"pull"==s||"b"==s||"[]"==s?l=!0:"][2"==s?(n=!0,a="push2"):"[]2"==s&&(l=!0,i="pull2")}u.push((0,h.f6)(this.k,e[o][c].children[d].dataset.name))}}let p=u.filter(e=>h.aD.includes(e)),f=u.filter(e=>h.Fv.includes(e));return f.length>p.length?(s=0,this.lastWay="pull",r={def:i,scales:f},t++):f.length<p.length?(t=0,this.lastWay="push",r={def:a,scales:p},s++):l?(s=0,this.lastWay="pull",r={def:i,scales:f},t++):n?(t=0,this.lastWay="push",r={def:a,scales:p},s++):"pull"===this.lastWay&&t<5||s>4?(s=0,this.lastWay="pull",r={def:i,scales:f},t++):(t=0,this.lastWay="push",r={def:a,scales:p},s++),this.lastEls=e,r}constructor(e){this.lastWay="",this.k="C",this.onStart=()=>{},this.onStop=()=>{},this.onFinished=()=>{},this.onBeat=()=>{},this.onEvent=e=>{O(this.colorElements(e.elements))},this.lastScales=[],this.lastEls=[],this.lastWay="",this.k=e}};return(0,n.useEffect)(()=>{null!=S&&S.pause(),R=r().compressToBase64(v),w("https://cylin743.github.io/concertina-abc-player/?t=".concat(encodeURIComponent(R)));let s=e.renderAbc("paper",v,{scale:1,staffwidth:700,paddingleft:0,paddingright:0,responsive:"resize",oneSvgPerLine:!0,add_classes:!0}),[t]=s;try{var l=new I("".concat(s[0].lines[0].staff[0].key.root).concat(s[0].lines[0].staff[0].key.acc)),n=new e.synth.SynthController;n.load("#main-midi",l,{displayRestart:!0,displayPlay:!0,displayProgress:!0,displayLoop:!0,displayWarp:!0,showCursor:!0}),n.setTune(t,!1,{soundFontUrl:"https://gleitz.github.io/midi-js-soundfonts/MusyngKite/",programOffsets:{},millisecondsPerMeasure:1e3,program:21}),j(n);for(var a=new e.TimingCallbacks(t,{}),i=[],o=!1,c=!1,u="",d="push",p="pull",f=0,g=0,m=0;m<a.noteTimings.length;m++){if(!a.noteTimings[m].hasOwnProperty("elements"))continue;for(var y=[],x=0;x<a.noteTimings[m].elements.length;x++)for(var C=0;C<a.noteTimings[m].elements[x][0].children.length;C++){let e=a.noteTimings[m].elements[x][0].children[C].textContent.toLowerCase();"push"==e||"r"==e||"]["==e?c=!0:"pull"==e||"b"==e||"[]"==e?o=!0:"][2"==e?(c=!0,d="push2"):"[]2"==e&&(o=!0,p="pull2");var b=a.noteTimings[m].elements[x][0].children[C].dataset.name;if(b.length<=3){var k="".concat(s[0].lines[0].staff[0].key.root).concat(s[0].lines[0].staff[0].key.acc),E=(0,h.f6)(k,b);y.push(E)}}if(0==y.length)continue;let e=y.filter(e=>h.aD.includes(e)),t=y.filter(e=>h.Fv.includes(e));t.length>e.length?(f=0,u="pull",g++,i.push({scales:t,def:p})):t.length<e.length?(g=0,u="push",f++,i.push({scales:e,def:d})):o?(f=0,u="pull",g++,i.push({scales:t,def:p})):c?(g=0,u="push",f++,i.push({scales:e,def:d})):"pull"===u&&g<5||f>4?(f=0,u="pull",g++,i.push({scales:t,def:p})):(g=0,u="push",f++,i.push({scales:e,def:d}))}var T=r().compressToBase64(JSON.stringify(i));B(encodeURIComponent(T))}catch(e){console.log(e)}},[v]),(0,l.jsxs)("main",{children:[(0,l.jsxs)("div",{id:"player-page",children:[(0,l.jsx)("h1",{children:"Anglo Concertina Player"}),(0,l.jsx)(c.Z,{onClick:()=>b(!0),children:"Share"}),(0,l.jsx)(c.Z,{onClick:()=>F("./tablature?tabs=".concat(Z)),children:"Tablature Page"}),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(p.Z,{expandIcon:(0,l.jsx)(f.Z,{}),"aria-controls":"panel1-content",id:"panel1-header",sx:{borderColor:"#aaa"},children:"Editor"}),(0,l.jsx)(d.Z,{children:(0,l.jsx)("textarea",{value:v,onChange:e=>x(e.target.value),style:m})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{id:"main-midi"}),(0,l.jsx)(h.Yy,{input:_}),(0,l.jsx)("div",{id:"paper"})]})]}),(0,l.jsx)(o.V,{isOpen:C,onClose:()=>b(!1),link:k,onCopy:()=>{navigator.clipboard.writeText(k)}})]})}let m={padding:"12px 10px",width:"98%",height:"250px"}}},function(e){e.O(0,[334,374,971,69,744],function(){return e(e.s=5428)}),_N_E=e.O()}]);