(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5428:function(e,s,t){Promise.resolve().then(t.bind(t,6911))},6911:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var l=t(7437),n=t(2265);t(9302);var a=t(7907),i=t(3224),r=t.n(i),o=t(6344),h=t(6926),u=t(6285),d=t(7241),p=t(6929),c=t(2486),f=t(1787);function g(){let e=t(1514),s=(0,a.useSearchParams)();var i=s.get("t")||"";i=""==i?atob(i=s.get("tune")||""):r().decompressFromBase64(decodeURIComponent(i))||"";let[g,y]=(0,n.useState)("C"),[v,x]=(0,n.useState)(i),[C,b]=(0,n.useState)(!1),[S,j]=(0,n.useState)(null),[w,E]=(0,n.useState)(""),[T,k]=(0,n.useState)(!1);(0,n.useRef)(null);let[W,P]=(0,n.useState)(0),[_,O]=(0,n.useState)({def:"push",scales:[]}),[Z,B]=(0,n.useState)(""),F=e=>{window.open(e,"_blank","noreferrer")},R=r().compressToBase64(v),I=class{colorElements(e){for(var s=0,t=0,l=!1,n=!1,a={},i=0;i<this.lastEls.length;i++)for(var r=0;r<this.lastEls[i].length;r++)this.lastEls[i][r].style.color="";for(var o=[],i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++){e[i][r].style.color="brown";for(var u=0;u<e[i][r].children.length;u++){if("chord"==e[i][r].children[u].dataset.name||"lyric"==e[i][r].children[u].dataset.name){let s=e[i][r].children[u].textContent.toLowerCase();"push"==s||"r"==s||"]["==s?n=!0:("pull"==s||"b"==s||"[]"==s)&&(l=!0)}o.push((0,h.f6)(g,e[i][r].children[u].dataset.name))}}let d=o.filter(e=>h.aD.includes(e)),p=o.filter(e=>h.Fv.includes(e));return p.length>d.length?(s=0,this.lastWay="pull",a={def:"pull",scales:p},t++):p.length<d.length?(t=0,this.lastWay="push",a={def:"push",scales:d},s++):l?(s=0,this.lastWay="pull",a={def:"pull",scales:p},t++):n?(t=0,this.lastWay="push",a={def:"push",scales:d},s++):"pull"===this.lastWay&&t<5||s>4?(s=0,this.lastWay="pull",a={def:"pull",scales:p},t++):(t=0,this.lastWay="push",a={def:"push",scales:d},s++),this.lastEls=e,a}constructor(){this.lastWay="",this.onStart=()=>{},this.onStop=()=>{},this.onFinished=()=>{},this.onBeat=()=>{},this.onEvent=e=>{O(this.colorElements(e.elements))},this.lastScales=[],this.lastEls=[],this.lastWay=""}};return(0,n.useEffect)(()=>{null!=S&&S.pause(),R=r().compressToBase64(v),E("https://cylin743.github.io/shamisen-player/?t=".concat(encodeURIComponent(R)));let s=e.renderAbc("paper",v,{scale:1,staffwidth:700,paddingleft:0,paddingright:0,responsive:"resize",oneSvgPerLine:!0,add_classes:!0}),[t]=s;var l=new I,n=new e.synth.SynthController;n.load("#main-midi",l,{displayRestart:!0,displayPlay:!0,displayProgress:!0,displayLoop:!0,displayWarp:!0,showCursor:!0}),n.setTune(t,!1,{soundFontUrl:"https://gleitz.github.io/midi-js-soundfonts/MusyngKite/",programOffsets:{},millisecondsPerMeasure:1e3,program:21}),j(n);try{y(s[0].lines[0].staff[0].key.root);for(var a=new e.TimingCallbacks(t,{}),i=[],o=!1,u=!1,d="",p=0,c=0,f=0;f<a.noteTimings.length;f++){if(!a.noteTimings[f].hasOwnProperty("elements"))continue;for(var g=[],m=0;m<a.noteTimings[f].elements.length;m++)for(var x=0;x<a.noteTimings[f].elements[m][0].children.length;x++){let e=a.noteTimings[f].elements[m][0].children[x].textContent.toLowerCase();"push"==e||"r"==e||"]["==e?u=!0:("pull"==e||"b"==e||"[]"==e)&&(o=!0);var C=a.noteTimings[f].elements[m][0].children[x].dataset.name;if(C.length<=3){var b=(0,h.f6)(s[0].lines[0].staff[0].key.root,C);g.push(b)}}if(0==g.length)continue;let e=g.filter(e=>h.aD.includes(e)),t=g.filter(e=>h.Fv.includes(e));t.length>e.length?(p=0,d="pull",c++,i.push({scales:t,def:"pull"})):t.length<e.length?(c=0,d="push",p++,i.push({scales:e,def:"push"})):o?(p=0,d="pull",c++,i.push({scales:t,def:"pull"})):u?(c=0,d="push",p++,i.push({scales:e,def:"push"})):"pull"===d&&c<5||p>4?(p=0,d="pull",c++,i.push({scales:t,def:"pull"})):(c=0,d="push",p++,i.push({scales:e,def:"push"}))}var w=r().compressToBase64(JSON.stringify(i));B(encodeURIComponent(w))}catch(e){console.log(e)}},[v]),(0,l.jsxs)("main",{children:[(0,l.jsxs)("div",{id:"player-page",children:[(0,l.jsx)("h1",{children:"Anglo Concertina Player"}),(0,l.jsx)(u.Z,{onClick:()=>b(!0),children:"Share"}),(0,l.jsx)(u.Z,{onClick:()=>F("./tablature?tabs=".concat(Z)),children:"Tablature Page"}),(0,l.jsxs)(d.Z,{children:[(0,l.jsx)(c.Z,{expandIcon:(0,l.jsx)(f.Z,{}),"aria-controls":"panel1-content",id:"panel1-header",sx:{borderColor:"#aaa"},children:"Editor"}),(0,l.jsx)(p.Z,{children:(0,l.jsx)("textarea",{value:v,onChange:e=>x(e.target.value),style:m})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{id:"main-midi"}),(0,l.jsx)(h.Yy,{input:_}),(0,l.jsx)("div",{id:"paper"})]})]}),(0,l.jsx)(o.V,{isOpen:C,onClose:()=>b(!1),link:w,onCopy:()=>{navigator.clipboard.writeText(w)}})]})}let m={padding:"12px 10px",width:"98%",height:"250px"}}},function(e){e.O(0,[334,374,971,69,744],function(){return e(e.s=5428)}),_N_E=e.O()}]);